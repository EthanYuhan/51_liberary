C51 COMPILER V9.60.7.0   DHT11                                                             05/18/2023 17:05:14 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN ..\OBJ\dht11.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\HARDWARE\dht11\dht11.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\USER;..\REA
                    -DME;..\HARDWARE\lcd12864;..\SYSTEM\delay;..\SYSTEM\sys;..\HARDWARE\key;..\HARDWARE\motor;..\HARDWARE\timer;..\HARDWARE\a
                    -d;..\HARDWARE\ds1302;..\HARDWARE\interrupt;..\HARDWARE\dht11) DEBUG OBJECTEXTEND PRINT(.\dht11.lst) TABS(2) OBJECT(..\OB
                    -J\dht11.obj)

line level    source

   1          #include "stc15f2k60s2.h"
   2          #include <stdio.h>
   3          #include "string.h"
   4          #include  "sys.h"
   5          
   6          
   7          sbit  DHT_IO  = P1^1 ;
   8          
   9          u8  U8FLAG,k;
  10          u8  U8count,U8temp;
  11          u8  U8T_data_H,U8T_data_L,U8RH_data_H,U8RH_data_L,U8checkdata;
  12          u8  U8T_data_H_temp,U8T_data_L_temp,U8RH_data_H_temp,U8RH_data_L_temp,U8checkdata_temp;
  13          u8  U8comdata;
  14          u8  outdata[5];  //定义发送的字节数    
  15          u8  indata[5];
  16          u8  count, count_r=0;
  17          u8  str[5]={"RS232"};
  18          u16 U16temp1,U16temp2;
  19          
  20          
  21          void Delay_10us(void)
  22          {
  23   1        delay2us(5);
  24   1      }
  25          
  26          
  27          
  28          void  COM(void)
  29          {
  30   1           
  31   1           u8 i;
  32   1                
  33   1             for(i=0;i<8;i++)    
  34   1            {
  35   2          
  36   2                U8FLAG=2; 
  37   2            while((!DHT_IO)&&U8FLAG++);
  38   2            Delay_10us();
  39   2            Delay_10us();
  40   2            Delay_10us();
  41   2              U8temp=0;
  42   2             if(DHT_IO)U8temp=1;
  43   2              U8FLAG=2;
  44   2           while((DHT_IO)&&U8FLAG++);
  45   2            //超时则跳出for循环      
  46   2             if(U8FLAG==1)break;
  47   2            //判断数据位是0还是1   
  48   2               
  49   2          // 如果高电平高过预定0高电平值则数据位为 1 
  50   2             
  51   2             U8comdata<<=1;
  52   2               U8comdata|=U8temp;        //0
C51 COMPILER V9.60.7.0   DHT11                                                             05/18/2023 17:05:14 PAGE 2   

  53   2             }//rof
  54   1           
  55   1      }
  56          
  57          //--------------------------------
  58            //-----湿度读取子程序 ------------
  59            //--------------------------------
  60            //----以下变量均为全局变量--------
  61            //----温度高8位== U8T_data_H------
  62            //----温度低8位== U8T_data_L------
  63            //----湿度高8位== U8RH_data_H-----
  64            //----湿度低8位== U8RH_data_L-----
  65            //----校验 8位 == U8checkdata-----
  66            //----调用相关子程序如下----------
  67            //---- delay1ms();, Delay_10us();,COM(); 
  68            //--------------------------------
  69          
  70          void UpdateTemp(void)
  71            {
  72   1          //主机拉低18ms 
  73   1           DHT_IO=0;
  74   1           delay1ms(18);
  75   1           DHT_IO=1;
  76   1         //总线由上拉电阻拉高 主机延时20us
  77   1           Delay_10us();
  78   1           Delay_10us();
  79   1      //     Delay_10us();
  80   1      //     Delay_10us();
  81   1         //主机设为输入 判断从机响应信号 
  82   1           DHT_IO=1;
  83   1         //判断从机是否有低电平响应信号 如不响应则跳出，响应则向下运行   
  84   1           if(!DHT_IO)     //T !    
  85   1           {
  86   2           U8FLAG=2;
  87   2         //判断从机是否发出 80us 的低电平响应信号是否结束  
  88   2           while((!DHT_IO)&&U8FLAG++);
  89   2           U8FLAG=2;
  90   2         //判断从机是否发出 80us 的高电平，如发出则进入数据接收状态
  91   2           while((DHT_IO)&&U8FLAG++);
  92   2         //数据接收状态    
  93   2           COM();
  94   2           U8RH_data_H_temp=U8comdata;
  95   2           COM();
  96   2           U8RH_data_L_temp=U8comdata;
  97   2           COM();
  98   2           U8T_data_H_temp=U8comdata;
  99   2           COM();
 100   2           U8T_data_L_temp=U8comdata;
 101   2           COM();
 102   2           U8checkdata_temp=U8comdata;
 103   2           DHT_IO=1;
 104   2         //数据校验 
 105   2         
 106   2           U8temp=(U8T_data_H_temp+U8T_data_L_temp+U8RH_data_H_temp+U8RH_data_L_temp);
 107   2           if(U8temp==U8checkdata_temp)
 108   2           {
 109   3              U8RH_data_H=U8RH_data_H_temp;
 110   3              U8RH_data_L=U8RH_data_L_temp;
 111   3            U8T_data_H=U8T_data_H_temp;
 112   3              U8T_data_L=U8T_data_L_temp;
 113   3              U8checkdata=U8checkdata_temp;
 114   3           }//fi
C51 COMPILER V9.60.7.0   DHT11                                                             05/18/2023 17:05:14 PAGE 3   

 115   2           }//fi
 116   1      
 117   1        }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    189    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     36       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
