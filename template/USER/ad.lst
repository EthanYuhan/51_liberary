C51 COMPILER V9.60.7.0   AD                                                                05/18/2023 17:05:14 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE AD
OBJECT MODULE PLACED IN ..\OBJ\ad.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\HARDWARE\ad\ad.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\USER;..\README;..
                    -\HARDWARE\lcd12864;..\SYSTEM\delay;..\SYSTEM\sys;..\HARDWARE\key;..\HARDWARE\motor;..\HARDWARE\timer;..\HARDWARE\ad;..\H
                    -ARDWARE\ds1302;..\HARDWARE\interrupt;..\HARDWARE\dht11) DEBUG OBJECTEXTEND PRINT(.\ad.lst) TABS(2) OBJECT(..\OBJ\ad.obj)

line level    source

   1          #include "stc15f2k60s2.h"
   2          #include "sys.h"
   3          #include "intrins.h" 
   4          #include "ad.h"
   5           
   6                                             
   7          
   8          /*Define ADC operation const for ADC_CONTR*/ 
   9          #define ADC_POWER   0x80            //ADC power control bit 
  10          #define ADC_FLAG    0x10            //ADC complete flag      模数转换结束标志位 
  11          #define ADC_START   0x08            //ADC start control bit  模数转换启动控制位 
  12          
  13          
  14          //转换速度控制位SPEED0和SPEED1，共四种状态，对应四种转换速度 
  15          #define ADC_SPEEDLL 0x00            //540 clocks  
  16          #define ADC_SPEEDL  0x20            //360 clocks 
  17          #define ADC_SPEEDH  0x40            //180 clocks 
  18          #define ADC_SPEEDHH 0x60            //90 clocks 
  19          
  20          
  21          
  22          /*---------------------------- 
  23          Get ADC result 
  24          ----------------------------*/ 
  25          u16 GetADCResult(u8 ch)                                // 
  26          { 
  27   1          u16 Vo;
  28   1          P1ASF = 0x01;                                        //选择P1口的哪一口 这里的口和ch要对应才能达到选择
             -该口
  29   1          ADC_CONTR = ADC_POWER | ADC_SPEEDLL | ch | ADC_START;//0x00|0x00|ch|0x08:选择A/D输入通道，开始A/D转换 
  30   1                                                               // 这么用语句的主要原因就是不能位寻址
  31   1                                                               //   通道选择在后3位所以直接用一个整数表示ch
  32   1                                                               //例如ch=6 那么对应的后三位就是110           
  33   1          _nop_();                             //Must wait before inquiry ， 
  34   1          _nop_();                             //设置ADC_CONTR寄存器后需加4个CPU时钟周期的延时，才能保证值被写入
             -ADC_CONTR寄存器 
  35   1          _nop_(); 
  36   1          _nop_(); 
  37   1          while (!(ADC_CONTR & ADC_FLAG));     //Wait complete flag 
  38   1      
  39   1         ADC_CONTR &= ~ADC_FLAG;               //Close ADC 将标志位清零等待下次硬件置1
  40   1                                               //也可以写成 ADC_CONTR= ADC_CONTR & ( ~ADC_FLAG)
  41   1         Vo=(ADC_RES<<2)+ADC_RESL;       //打开10位AD采集功能   如果用8位AD Vo=ADC_RESL 即可
  42   1                                               //10位AD采集 即2的10次方 满值为1024 这里用1024表示5伏的电压 
  43   1                           //8位AD采集 即 2的8次方  满值为256  用256表示5伏
  44   1          return Vo; 
  45   1      } 
  46          
  47          /*************************************************************************************/
  48          
  49          


C51 COMPILER V9.60.7.0   AD                                                                05/18/2023 17:05:14 PAGE 2   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     38    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
